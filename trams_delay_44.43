{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "disabled-pakistan",
   "metadata": {
    "ExecuteTime": {
     "end_time": "2021-10-25T08:51:06.834160Z",
     "start_time": "2021-10-25T08:51:05.546014Z"
    }
   },
   "outputs": [],
   "source": [
    "#import bibliotek\n",
    "\n",
    "import pandas as pd\n",
    "import numpy as np\n",
    "np.random.seed(0)\n",
    "from sklearn.model_selection import cross_val_score\n",
    "import xgboost as xgb\n",
    "from datetime import datetime\n",
    "\n",
    "from sklearn.tree import DecisionTreeRegressor, DecisionTreeClassifier\n",
    "from sklearn.ensemble import RandomForestRegressor, RandomForestClassifier\n",
    "from scikitplot.estimators import plot_learning_curve\n",
    "from sklearn.model_selection import train_test_split, StratifiedKFold\n",
    "from sklearn.model_selection import cross_val_score, StratifiedKFold, cross_val_predict\n",
    "import scikitplot as skplt\n",
    "from scikitplot.estimators import plot_learning_curve\n",
    "import eli5\n",
    "import seaborn as sns\n",
    "\n",
    "import xgboost as xgb\n",
    "import lightgbm as lgb\n",
    "import catboost as ctb\n",
    "    \n",
    "import matplotlib.pyplot as plt\n",
    "%matplotlib inline"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "several-postage",
   "metadata": {},
   "outputs": [],
   "source": [
    "#wczytanie df_train i df_test\n",
    "df_train = pd.read_hdf('../input/tram.train.h5')\n",
    "df_test = pd.read_hdf('../input/tram.test.h5') #zbiór testowy bez odpowiedzi"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "pregnant-jungle",
   "metadata": {},
   "outputs": [],
   "source": [
    "# rzeczywista różnica między czasem planowanym a czasem przyjazdu w sekundach\n",
    "df_train[\"real_delay\"] = (pd.to_datetime( df_train[\"datetime\"] ) - pd.to_datetime(df_train[\"planned_time\"]))\n",
    "df_train[\"real_delay\"] = df_train[\"real_delay\"] /pd.Timedelta(seconds=1)\n",
    "\n",
    "#modyfikacja zmiennej => przesunięcie=200 i log => rozkład ziennej zbliżony do normalnego\n",
    "df_train[\"log_real_delay+200\"] = np.log(df_train[\"real_delay\"] + 200)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "instrumental-triangle",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 1440x360 with 3 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "#histogramy\n",
    "plt.figure(figsize=(20, 5))\n",
    "plt.subplot(131)\n",
    "df_train[\"delay\"].hist(bins=30)\n",
    "plt.title('delay')\n",
    "\n",
    "plt.subplot(132)\n",
    "df_train[\"real_delay\"].hist(bins=30)\n",
    "plt.title('real_delay')\n",
    "\n",
    "plt.subplot(133)\n",
    "np.log(df_train[\"real_delay\"] + 200).hist(bins=30)\n",
    "plt.title('log_real_delay + 200');\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "single-lodge",
   "metadata": {},
   "outputs": [],
   "source": [
    "# uzupełnienie braków w \"seq_num\"\n",
    "df_train[\"seq_num\"] = df_train[\"seq_num\"].fillna(-1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "soviet-south",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>delay</th>\n",
       "      <th>datetime</th>\n",
       "      <th>stop</th>\n",
       "      <th>stop_name</th>\n",
       "      <th>number</th>\n",
       "      <th>direction</th>\n",
       "      <th>planned_time</th>\n",
       "      <th>vehicle_id</th>\n",
       "      <th>trip_id</th>\n",
       "      <th>seq_num</th>\n",
       "      <th>real_delay</th>\n",
       "      <th>log_real_delay+200</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>198055</th>\n",
       "      <td>198055</td>\n",
       "      <td>0</td>\n",
       "      <td>2018-07-27 13:14:18</td>\n",
       "      <td>136</td>\n",
       "      <td>Bronowice Wiadukt</td>\n",
       "      <td>24</td>\n",
       "      <td>Bronowice Małe</td>\n",
       "      <td>2018-07-27 13:14:00</td>\n",
       "      <td>6.352185e+18</td>\n",
       "      <td>6351558574046752009</td>\n",
       "      <td>27.0</td>\n",
       "      <td>18.0</td>\n",
       "      <td>5.384495</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13484</th>\n",
       "      <td>13484</td>\n",
       "      <td>120</td>\n",
       "      <td>2018-07-23 10:42:27</td>\n",
       "      <td>612</td>\n",
       "      <td>Borsucza</td>\n",
       "      <td>22</td>\n",
       "      <td>Walcownia</td>\n",
       "      <td>2018-07-23 10:40:00</td>\n",
       "      <td>6.352185e+18</td>\n",
       "      <td>6351558574044891398</td>\n",
       "      <td>7.0</td>\n",
       "      <td>147.0</td>\n",
       "      <td>5.849325</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>30626</th>\n",
       "      <td>30626</td>\n",
       "      <td>0</td>\n",
       "      <td>2018-07-23 16:42:39</td>\n",
       "      <td>1263</td>\n",
       "      <td>Mały Płaszów</td>\n",
       "      <td>11</td>\n",
       "      <td>Czerwone Maki P+R</td>\n",
       "      <td>2018-07-23 16:43:00</td>\n",
       "      <td>6.352185e+18</td>\n",
       "      <td>6351558574044662032</td>\n",
       "      <td>1.0</td>\n",
       "      <td>-21.0</td>\n",
       "      <td>5.187386</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>35732</th>\n",
       "      <td>35732</td>\n",
       "      <td>60</td>\n",
       "      <td>2018-07-23 18:20:00</td>\n",
       "      <td>363</td>\n",
       "      <td>Hala Targowa</td>\n",
       "      <td>1</td>\n",
       "      <td>Salwator</td>\n",
       "      <td>2018-07-23 18:19:00</td>\n",
       "      <td>6.352185e+18</td>\n",
       "      <td>6351558574044354826</td>\n",
       "      <td>24.0</td>\n",
       "      <td>60.0</td>\n",
       "      <td>5.560682</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18829</th>\n",
       "      <td>18829</td>\n",
       "      <td>120</td>\n",
       "      <td>2018-07-23 12:40:34</td>\n",
       "      <td>679</td>\n",
       "      <td>Ćwiklińskiej</td>\n",
       "      <td>9</td>\n",
       "      <td>Nowy Bieżanów P+R</td>\n",
       "      <td>2018-07-23 12:38:00</td>\n",
       "      <td>6.352185e+18</td>\n",
       "      <td>6351558574044625159</td>\n",
       "      <td>35.0</td>\n",
       "      <td>154.0</td>\n",
       "      <td>5.869297</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "            id  delay             datetime  stop          stop_name  number  \\\n",
       "198055  198055      0  2018-07-27 13:14:18   136  Bronowice Wiadukt      24   \n",
       "13484    13484    120  2018-07-23 10:42:27   612           Borsucza      22   \n",
       "30626    30626      0  2018-07-23 16:42:39  1263       Mały Płaszów      11   \n",
       "35732    35732     60  2018-07-23 18:20:00   363       Hala Targowa       1   \n",
       "18829    18829    120  2018-07-23 12:40:34   679       Ćwiklińskiej       9   \n",
       "\n",
       "                direction         planned_time    vehicle_id  \\\n",
       "198055     Bronowice Małe  2018-07-27 13:14:00  6.352185e+18   \n",
       "13484           Walcownia  2018-07-23 10:40:00  6.352185e+18   \n",
       "30626   Czerwone Maki P+R  2018-07-23 16:43:00  6.352185e+18   \n",
       "35732            Salwator  2018-07-23 18:19:00  6.352185e+18   \n",
       "18829   Nowy Bieżanów P+R  2018-07-23 12:38:00  6.352185e+18   \n",
       "\n",
       "                    trip_id  seq_num  real_delay  log_real_delay+200  \n",
       "198055  6351558574046752009     27.0        18.0            5.384495  \n",
       "13484   6351558574044891398      7.0       147.0            5.849325  \n",
       "30626   6351558574044662032      1.0       -21.0            5.187386  \n",
       "35732   6351558574044354826     24.0        60.0            5.560682  \n",
       "18829   6351558574044625159     35.0       154.0            5.869297  "
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df = pd.concat([df_train, df_test])\n",
    "df.shape\n",
    "df_train.sample(5)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "romantic-welding",
   "metadata": {},
   "outputs": [],
   "source": [
    "#features\n",
    "\n",
    "#zmianne średnia/mediana opóźnienia w zależności od seq_num\n",
    "dict_mean_del_by_seq = df_train.groupby('seq_num').agg(np.mean)['log_real_delay+200'].to_dict()\n",
    "dict_median_del_by_seq = df_train.groupby('seq_num').agg(np.median)['log_real_delay+200'].to_dict()\n",
    "df['mean_delay_on_seq'] =df.seq_num.map(dict_mean_del_by_seq)\n",
    "df['median_delay_on_seq'] =df.seq_num.map(dict_median_del_by_seq)\n",
    "\n",
    "#planowana godz. i minuta\n",
    "df['hour_and_min']= df['planned_time'].map(lambda x: \"{:d}:{:02d}\".format(datetime.fromisoformat(x).hour, datetime.fromisoformat(x).minute))\n",
    "\n",
    "#factorize\n",
    "df[\"seq_num\"]= df[\"seq_num\"].fillna(-1)\n",
    "df[\"stop_name\"] = df[\"stop_name\"].factorize()[0]\n",
    "df[\"direction\"] = df[\"direction\"].factorize()[0]\n",
    "df[\"vehicle_id\"] = df[\"vehicle_id\"].factorize()[0]\n",
    "df['hour_and_min'] = df['hour_and_min'].factorize()[0]\n",
    "\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "other-military",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>id</th>\n",
       "      <th>delay</th>\n",
       "      <th>datetime</th>\n",
       "      <th>stop</th>\n",
       "      <th>stop_name</th>\n",
       "      <th>number</th>\n",
       "      <th>direction</th>\n",
       "      <th>planned_time</th>\n",
       "      <th>vehicle_id</th>\n",
       "      <th>trip_id</th>\n",
       "      <th>seq_num</th>\n",
       "      <th>real_delay</th>\n",
       "      <th>log_real_delay+200</th>\n",
       "      <th>mean_delay_on_seq</th>\n",
       "      <th>median_delay_on_seq</th>\n",
       "      <th>hour_and_min</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>47215</th>\n",
       "      <td>47215</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>681</td>\n",
       "      <td>69</td>\n",
       "      <td>13</td>\n",
       "      <td>7</td>\n",
       "      <td>2018-07-24 00:01:00</td>\n",
       "      <td>1</td>\n",
       "      <td>6351558574044715284</td>\n",
       "      <td>25.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>5.689907</td>\n",
       "      <td>5.673323</td>\n",
       "      <td>1163</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>47216</th>\n",
       "      <td>47216</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2582</td>\n",
       "      <td>90</td>\n",
       "      <td>13</td>\n",
       "      <td>7</td>\n",
       "      <td>2018-07-24 00:02:00</td>\n",
       "      <td>1</td>\n",
       "      <td>6351558574044715284</td>\n",
       "      <td>26.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>5.702604</td>\n",
       "      <td>5.686975</td>\n",
       "      <td>1190</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>47217</th>\n",
       "      <td>47217</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>112</td>\n",
       "      <td>11</td>\n",
       "      <td>10</td>\n",
       "      <td>15</td>\n",
       "      <td>2018-07-24 00:00:00</td>\n",
       "      <td>0</td>\n",
       "      <td>6351558574044641557</td>\n",
       "      <td>18.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>5.653268</td>\n",
       "      <td>5.631212</td>\n",
       "      <td>1082</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>47218</th>\n",
       "      <td>47218</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>679</td>\n",
       "      <td>112</td>\n",
       "      <td>13</td>\n",
       "      <td>7</td>\n",
       "      <td>2018-07-24 00:04:00</td>\n",
       "      <td>1</td>\n",
       "      <td>6351558574044715284</td>\n",
       "      <td>27.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>5.697250</td>\n",
       "      <td>5.690359</td>\n",
       "      <td>1083</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>47219</th>\n",
       "      <td>47219</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>407</td>\n",
       "      <td>13</td>\n",
       "      <td>10</td>\n",
       "      <td>15</td>\n",
       "      <td>2018-07-24 00:01:00</td>\n",
       "      <td>0</td>\n",
       "      <td>6351558574044641557</td>\n",
       "      <td>19.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>5.673441</td>\n",
       "      <td>5.648974</td>\n",
       "      <td>1163</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>308141</th>\n",
       "      <td>308141</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>89</td>\n",
       "      <td>21</td>\n",
       "      <td>14</td>\n",
       "      <td>2</td>\n",
       "      <td>2018-07-31 23:55:00</td>\n",
       "      <td>1</td>\n",
       "      <td>6351558574044741905</td>\n",
       "      <td>33.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>5.615387</td>\n",
       "      <td>5.570249</td>\n",
       "      <td>1077</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>308142</th>\n",
       "      <td>308142</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2690</td>\n",
       "      <td>134</td>\n",
       "      <td>18</td>\n",
       "      <td>1</td>\n",
       "      <td>2018-07-31 23:57:00</td>\n",
       "      <td>1</td>\n",
       "      <td>6351558574044791061</td>\n",
       "      <td>24.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>5.696006</td>\n",
       "      <td>5.680173</td>\n",
       "      <td>1079</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>308143</th>\n",
       "      <td>308143</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>133</td>\n",
       "      <td>122</td>\n",
       "      <td>14</td>\n",
       "      <td>2</td>\n",
       "      <td>2018-07-31 23:56:00</td>\n",
       "      <td>1</td>\n",
       "      <td>6351558574044741905</td>\n",
       "      <td>34.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>5.653461</td>\n",
       "      <td>5.631212</td>\n",
       "      <td>1078</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>308144</th>\n",
       "      <td>308144</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>630</td>\n",
       "      <td>51</td>\n",
       "      <td>24</td>\n",
       "      <td>12</td>\n",
       "      <td>2018-07-31 23:56:00</td>\n",
       "      <td>0</td>\n",
       "      <td>6351558574044950804</td>\n",
       "      <td>23.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>5.684341</td>\n",
       "      <td>5.673323</td>\n",
       "      <td>1078</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>308145</th>\n",
       "      <td>308145</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2691</td>\n",
       "      <td>129</td>\n",
       "      <td>18</td>\n",
       "      <td>1</td>\n",
       "      <td>2018-07-31 23:58:00</td>\n",
       "      <td>1</td>\n",
       "      <td>6351558574044791061</td>\n",
       "      <td>25.0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>5.689907</td>\n",
       "      <td>5.673323</td>\n",
       "      <td>1080</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>132166 rows × 16 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "            id  delay datetime  stop  stop_name  number  direction  \\\n",
       "47215    47215    NaN      NaN   681         69      13          7   \n",
       "47216    47216    NaN      NaN  2582         90      13          7   \n",
       "47217    47217    NaN      NaN   112         11      10         15   \n",
       "47218    47218    NaN      NaN   679        112      13          7   \n",
       "47219    47219    NaN      NaN   407         13      10         15   \n",
       "...        ...    ...      ...   ...        ...     ...        ...   \n",
       "308141  308141    NaN      NaN    89         21      14          2   \n",
       "308142  308142    NaN      NaN  2690        134      18          1   \n",
       "308143  308143    NaN      NaN   133        122      14          2   \n",
       "308144  308144    NaN      NaN   630         51      24         12   \n",
       "308145  308145    NaN      NaN  2691        129      18          1   \n",
       "\n",
       "               planned_time  vehicle_id              trip_id  seq_num  \\\n",
       "47215   2018-07-24 00:01:00           1  6351558574044715284     25.0   \n",
       "47216   2018-07-24 00:02:00           1  6351558574044715284     26.0   \n",
       "47217   2018-07-24 00:00:00           0  6351558574044641557     18.0   \n",
       "47218   2018-07-24 00:04:00           1  6351558574044715284     27.0   \n",
       "47219   2018-07-24 00:01:00           0  6351558574044641557     19.0   \n",
       "...                     ...         ...                  ...      ...   \n",
       "308141  2018-07-31 23:55:00           1  6351558574044741905     33.0   \n",
       "308142  2018-07-31 23:57:00           1  6351558574044791061     24.0   \n",
       "308143  2018-07-31 23:56:00           1  6351558574044741905     34.0   \n",
       "308144  2018-07-31 23:56:00           0  6351558574044950804     23.0   \n",
       "308145  2018-07-31 23:58:00           1  6351558574044791061     25.0   \n",
       "\n",
       "        real_delay  log_real_delay+200  mean_delay_on_seq  \\\n",
       "47215          NaN                 NaN           5.689907   \n",
       "47216          NaN                 NaN           5.702604   \n",
       "47217          NaN                 NaN           5.653268   \n",
       "47218          NaN                 NaN           5.697250   \n",
       "47219          NaN                 NaN           5.673441   \n",
       "...            ...                 ...                ...   \n",
       "308141         NaN                 NaN           5.615387   \n",
       "308142         NaN                 NaN           5.696006   \n",
       "308143         NaN                 NaN           5.653461   \n",
       "308144         NaN                 NaN           5.684341   \n",
       "308145         NaN                 NaN           5.689907   \n",
       "\n",
       "        median_delay_on_seq  hour_and_min  \n",
       "47215              5.673323          1163  \n",
       "47216              5.686975          1190  \n",
       "47217              5.631212          1082  \n",
       "47218              5.690359          1083  \n",
       "47219              5.648974          1163  \n",
       "...                     ...           ...  \n",
       "308141             5.570249          1077  \n",
       "308142             5.680173          1079  \n",
       "308143             5.631212          1078  \n",
       "308144             5.673323          1078  \n",
       "308145             5.673323          1080  \n",
       "\n",
       "[132166 rows x 16 columns]"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df[ df[\"delay\"].isnull() ]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "divine-mason",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "['stop',\n",
       " 'stop_name',\n",
       " 'number',\n",
       " 'direction',\n",
       " 'vehicle_id',\n",
       " 'seq_num',\n",
       " 'mean_delay_on_seq',\n",
       " 'median_delay_on_seq',\n",
       " 'hour_and_min']"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# zmienne do modelu\n",
    "feats = df.columns\n",
    "black_list = [\"id\",\"datetime\",\"planned_time\", \"trip_id\",\"delay\",\"real_delay\",'log_real_delay+200']\n",
    "feats = [x for x in feats if x not in black_list]\n",
    "feats"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "married-probability",
   "metadata": {},
   "outputs": [],
   "source": [
    "# train i test\n",
    "df_train = df[ df[\"delay\"].notnull() ].copy()\n",
    "df_test = df[ df[\"delay\"].isnull() ].copy()\n",
    "\n",
    "X_train = df_train[feats].values\n",
    "y_train = df_train[\"log_real_delay+200\"].values\n",
    "X_test = df_test[feats].values"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "moving-member",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(-0.1694708873020296, 0.003984851030311529)"
      ]
     },
     "execution_count": 11,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#model\n",
    "model = xgb.XGBRegressor(objective ='reg:squarederror', n_estimators=100, random_state=0)\n",
    "#model = xgb.XGBRegressor(max_depth=7, n_estimators=100, random_state=0)\n",
    "#model = ctb.CatBoostRegressor(n_estimators=100, depth=5, random_state=0, verbose=False)\n",
    "\n",
    "scores = cross_val_score(model, X_train, y_train, cv=5, scoring=\"neg_mean_absolute_error\")\n",
    "model.fit(X_train, y_train)\n",
    "np.mean(scores), np.std(scores)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "pressed-porcelain",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "\n",
       "    <style>\n",
       "    table.eli5-weights tr:hover {\n",
       "        filter: brightness(85%);\n",
       "    }\n",
       "</style>\n",
       "\n",
       "\n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "        <table class=\"eli5-weights eli5-feature-importances\" style=\"border-collapse: collapse; border: none; margin-top: 0em; table-layout: auto;\">\n",
       "    <thead>\n",
       "    <tr style=\"border: none;\">\n",
       "        <th style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">Weight</th>\n",
       "        <th style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">Feature</th>\n",
       "    </tr>\n",
       "    </thead>\n",
       "    <tbody>\n",
       "    \n",
       "        <tr style=\"background-color: hsl(120, 100.00%, 80.00%); border: none;\">\n",
       "            <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "                0.2644\n",
       "                \n",
       "            </td>\n",
       "            <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "                mean_delay_on_seq\n",
       "            </td>\n",
       "        </tr>\n",
       "    \n",
       "        <tr style=\"background-color: hsl(120, 100.00%, 86.94%); border: none;\">\n",
       "            <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "                0.1439\n",
       "                \n",
       "            </td>\n",
       "            <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "                number\n",
       "            </td>\n",
       "        </tr>\n",
       "    \n",
       "        <tr style=\"background-color: hsl(120, 100.00%, 87.52%); border: none;\">\n",
       "            <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "                0.1349\n",
       "                \n",
       "            </td>\n",
       "            <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "                seq_num\n",
       "            </td>\n",
       "        </tr>\n",
       "    \n",
       "        <tr style=\"background-color: hsl(120, 100.00%, 89.51%); border: none;\">\n",
       "            <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "                0.1052\n",
       "                \n",
       "            </td>\n",
       "            <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "                direction\n",
       "            </td>\n",
       "        </tr>\n",
       "    \n",
       "        <tr style=\"background-color: hsl(120, 100.00%, 90.12%); border: none;\">\n",
       "            <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "                0.0965\n",
       "                \n",
       "            </td>\n",
       "            <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "                vehicle_id\n",
       "            </td>\n",
       "        </tr>\n",
       "    \n",
       "        <tr style=\"background-color: hsl(120, 100.00%, 91.35%); border: none;\">\n",
       "            <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "                0.0798\n",
       "                \n",
       "            </td>\n",
       "            <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "                stop\n",
       "            </td>\n",
       "        </tr>\n",
       "    \n",
       "        <tr style=\"background-color: hsl(120, 100.00%, 92.38%); border: none;\">\n",
       "            <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "                0.0666\n",
       "                \n",
       "            </td>\n",
       "            <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "                stop_name\n",
       "            </td>\n",
       "        </tr>\n",
       "    \n",
       "        <tr style=\"background-color: hsl(120, 100.00%, 92.95%); border: none;\">\n",
       "            <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "                0.0596\n",
       "                \n",
       "            </td>\n",
       "            <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "                median_delay_on_seq\n",
       "            </td>\n",
       "        </tr>\n",
       "    \n",
       "        <tr style=\"background-color: hsl(120, 100.00%, 93.83%); border: none;\">\n",
       "            <td style=\"padding: 0 1em 0 0.5em; text-align: right; border: none;\">\n",
       "                0.0493\n",
       "                \n",
       "            </td>\n",
       "            <td style=\"padding: 0 0.5em 0 0.5em; text-align: left; border: none;\">\n",
       "                hour_and_min\n",
       "            </td>\n",
       "        </tr>\n",
       "    \n",
       "    \n",
       "    </tbody>\n",
       "</table>\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "    \n",
       "\n",
       "\n",
       "\n"
      ],
      "text/plain": [
       "<IPython.core.display.HTML object>"
      ]
     },
     "execution_count": 12,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#ważność cech\n",
    "eli5.show_weights(model, feature_names=feats)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "superior-friendship",
   "metadata": {},
   "outputs": [],
   "source": [
    "#train, predict\n",
    "y_pred_log = model.predict(X_test)\n",
    "y_pred_log[ y_pred_log < 0 ] = 1e-6\n",
    "y_pred = np.exp( y_pred_log ) - 200\n",
    "y_pred = np.floor(y_pred/60) * 60\n",
    "y_pred[ y_pred < 0 ] = 0\n",
    "df_test[\"delay\"] = y_pred"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "advanced-rogers",
   "metadata": {},
   "outputs": [],
   "source": [
    "!mkdir -p ../output"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "visible-federation",
   "metadata": {},
   "outputs": [],
   "source": [
    "#zapis\n",
    "df_test[ [\"id\", \"delay\"] ].to_csv('../output/JL_v18.csv', index=False)"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.8.6"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
